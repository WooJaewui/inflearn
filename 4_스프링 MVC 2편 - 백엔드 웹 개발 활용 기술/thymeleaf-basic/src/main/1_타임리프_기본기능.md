
# 타임리프 - 기본 기능.

-----------------------------------------------------------------------------------------------------------------------------

> ## 타임리프 소개.

### 타임리프 특징.
- 서버 사이드 HTML 렌더링(SSR)
- 네츄럴 템플릿.
- 스프링 통합 지원.

### 서버 사이드 HTML 렌더링 SSR.
- 타임리프는 백엔드 서버에서 HTML을 동적으로 렌더링 하는 용도로 사용된다.

### 네츄럴 템플릿.
- 타임리프는 순수 HTML을 최대한 유지하는 특징이 있다.
- 타임리프로 작성한 파일은 HTML을 유지하기 때문에 웹 브라우저에서 파일을 직접 열어도 내용을 확인할 수 있다. 
- 서버를 통해 뷰 템플릿을 거치면 동적으로 변경된 결과를 확인할 수 있다.
- JSP를 포함한 다른 뷰 템플릿들은 해당 파일을 열면, HTML이 뒤죽박죽 섞여서 웹 브라우저에서 정상적인 HTML 결과를 확인할 수 없다.
- 반면에 타임리프로 작성된 파일은 해당 파일을 그대로 웹 브라우저에서 열어도 정상적인 HTML 결과를 확인할 수 있다.
- 이렇게 순수 HTML을 그대로 유지하면서 뷰 템플릿도 사용할 수 있는 타임리프의 특징을 '네츄럴 템플릿' 이라 한다.

### 스프링 통합 지원.
- 타임리프는 스프링과 자연스럽게 통합되고, 스프링의 다양한 기능을 편리하게 사용할 수 있게 지원한다.
- 이 부분은 스프링 통합과 폼 장에서 자세히 알아보겠다.

### 타임리프 사용 선언.
    <html xmlns:th="http://www.thymleaf.org"></html>

-----------------------------------------------------------------------------------------------------------------------------

> ## 텍스트 - text, utext.

### 개요.
    
- 타임리프의 가장 기본 기능인 텍스트를 출력하는 기능 먼저 알아보자.

### 텍스트 출력하기.
    <span th:text="${data}"></span> 
- 태그 안에서 출력하는 방법.

### 컨텐츠 안에서 직접 출력하기.
    <li>출력하기 = [[${data}]]</li>
- 태그 안에서 직접 출력하는 방법.

### Escape.
- 뷰 템플릿으로 html 화면을 생성할 때는 출력하는 데이터에 이러한 특수 문자가 있는 것을 주의해서 사용해야 한다.

### HTML 엔티티.
- 웹 브라우저는 '<'를 HTML 태그의 시작으로 인식한다.
- 따라서 '<'를 태그의 시작이 아니라 문자로 표현할 수 있는 방법이 필요한데, 이것을 HTML 엔티티라고 한다.
- 이렇게 HTML에서 사용하는 특수 문자를 HTML 엔티티로 변경하는 것을 Escape 문자라고 한다.
- 그리고 타임리프는 기본적으로 이스케이프를 제공한다.

### unescape 사용 예시.
    // 태그 안에서 사용.
    <span th:utext="${data}"></span>

    // 컨텐츠 안에서 직접 출력하기.
    <li>출력하기 = {(${data})}</li>

-----------------------------------------------------------------------------------------------------------------------------

> ## 변수 - SpringEl.

### 개요.
- 타임리프에서 변수를 사용할 떄는 변수 표현식을 사용한다.
- 그리고 이 변수 표현식에는 '스프링 EL'이라는 스프링이 제공하는 표현식을 사용할 수 있다.

### Spring EL 사용 방법.
    // object
    th:text="${user.username}"
    th:text="${user['username']}"
    th:text="${user.getUsername()}"

    // list.
    th:text="${users[0].username}"
    th:text="${users[0]['username']}"
    th:text="${users[0].getUsername()}"

    // map.
    th:text="${userMap['key'].username}"
    th:text="${userMap['key']['username']}"
    th:text="${usetMap['key'].getUsername()}"

### 변수 선언하기.
    // with.
    <div th:with="first=${users[0]}">
        <p>첫 번째 사람 이름은 : <span th:text="fist.username"></span></p>
    </div>

-----------------------------------------------------------------------------------------------------------------------------

> ## 기본 객체들.

### 기본 객체 사용하기.
    th:text="${#request}"
    th:text="${#sesssion}"
    th:text="${#response}"
    th:text="${#servletContext}"
    th:text="${#locale}"

### 편의 객체 사용하기.
    th:text="${param.파라미터이름}"
    th:text="${session.세션키이름}"
    th:text="${@빈이름.메서드()}"

-----------------------------------------------------------------------------------------------------------------------------

> ## 유틸리티 객체와 날짜.

### 개요.
- 타임리프는 문자, 숫자, 날짜, URI 등을 편리하게 다루는 다양한 유틸리티 객체들을 제공한다.

### 유틸리티 객체들.
- 다양한 유틸리티와 예제들을 링크를 타고 확인해 보자.

### 자바8 날짜.
    th:text="${#temporals.day(날짜)}"
    th:text="${#temporals.month(날짜)}"

-----------------------------------------------------------------------------------------------------------------------------

> ## URL 링크.

### URL 링크 사용법.
    // 기본
    <a th:href="@{/hello}"/>

    // 파라미터.
    <a th:href="@{/hello}(param1=${param1}, param2=${param2})"/>
    
    // path Variabel.
    <a th:href="@{/hello/{path1}/{path2}(path1=${path1}, path2=${path2})}"/>

    // path variable + 파라미터.
    <a th:href="@{/hello/{path1} (path1=${path1}, param1=${param1})}"/>

-----------------------------------------------------------------------------------------------------------------------------

> ## 리터럴.

### Literals.
- 리터럴은 소스 코드상에 고정된 값을 말하는 용어이다.
- 예를 들어 "Hello"는 문자 리터럴, 10,20은 숫자 리터럴이다.
- 이 내용이 쉬워 보이지만 처음 타임리프를 사용하면 많이 실수하니 잘 보아두자.

### 타임리프는 다음과 같은 리터럴이 있따.
- 문자 = 'hello'
- 숫자 = '10'
- 불린 = 'true', 'false'
- null = 'null'

### 주의사항.
- 타임리프에서 문자 리터럴은 항상 ''(작은 따옴표)로 감싸야 한다.
- 그런데 문자를 항상 ' '로 감싸는 것은 너무 귀찮은 일이다. 
- 공백 없이 쭉 이어진다면 하나의 의미있는 토큰으로 인지해서 다음과 같이 작은 따옴표를 생략할 수 있다.

### 오류.
    // 오류.
    <span th:text="hello world"></span>

    // 정상.
    <span th:text="'hello world'"></span>
    <span th:text="|hello world|"></span>
    <span th:text="'hello' + ${data}"></span>

-----------------------------------------------------------------------------------------------------------------------------

> ## 연산.

### 개요.
- 타임리프 연산은 자바와 크게 다르지 않다.
- HTML 안에서 사용하기 때문에 엔티티를 사용하는 부분만 조심하면 된다.

### 연산 예시 코드.
    // 비교 연산.
    1 gt 2      =>      1 > 2
    1 lt 2      =>      1 < 2
    1 ge 2      =>      1 >= 2
    1 le 2      =>      1 <= 2
    
    th:text="${data}?: 'data가 널인 경우'"
    th:text="(조건)? 'true인 경우 수행' : 'false인 경우 실행'"
    
    // no 오퍼레이션. (타임리프 연산을 수행하지 않음)    
    th:text="${data}?: _ 

-----------------------------------------------------------------------------------------------------------------------------

> ## 속성 값 설정.

### 속성 설정.
- 타임리프 렌더링 후 기존 속성을 대체하고, 없으면 새로 속성을 생성한다.


### 인텔리제이 절대 경로.
- 소스 파일 우클릭 -> Copy Path/Reference -> Absolute Path.


### 속성 값 설정 활용.
    // 속성 추가.
    th:attrappend="class=' large'"
    th:attrprepend="class='large '"
    th:classappend="large"

    // checked 처리.
    th:cheched="true"
    th:checked="false"
    

### HTML 체크 처리.
- HTML에서 checked=false를 해도 checked가 존재만하면 check처리된다.
- 타임리프 th:checked는 값이 false인 경우 checked 속성 자체를 제거한다.

-----------------------------------------------------------------------------------------------------------------------------

> ## 반복.


### 개요.
- 타임리프에서 반복은 'th:each'를 통해 사용한다.


### 반복 기능.
    <tr th:each="user : ${users}">
- th:each는 List뿐만 아니라 배열, Iterable, Enumeration을 구현한 모든 객체를 반복에 사용할 수 있다.


## 반복 상태 유지 기능.
- index : 0부터 시작하는 값.
- count : 1부터 시작하는 값.
- size : 전체 사이즈.
- even, odd : 홀수, 짝수 여부.
- first, last : 처음 마지막 부분.
- current : 현재 객체.

-----------------------------------------------------------------------------------------------------------------------------

> ## 조건부 평가.


### 개요.
- 'if', 'unless'를 사용한다.


### if, unless.
- if, unless를 사용하는 경우, 조건을 만족하는 경우 태그를 표시하고, 만족하지 않으면 태그 자체를 없앤다.


### switch, case. 
    <tr th:switch="${user.age}">
        <td th:text="10살" th:case="10"></td>
        <td th:text="20살" th:case="20"></td>
    </tr>

-----------------------------------------------------------------------------------------------------------------------------

> ## 주석.

### HTML 주석.
    <!-- 주석 -->
- 모든 HTML이 주석처리 된다.


### 타임리프 파서 주석.
    <!--/* [{$data}]] */-->
- 렌더링에서 주석 부분을 제거한다.


### 타임리프 프로토 타입 주석.
    <!--/*/ <span th:text="${data}"> html data </span> /*/-->
- 웹 브라우저에서 파일을 열어서 확인할 때는 주석이 처리된다.
- 타임리프로 렌더링 된 경우에는 주석처리되지 않고 코드가 보인다.

-----------------------------------------------------------------------------------------------------------------------------

> ## 블록.

### 개요.
- HTML 태그가 아닌 타임리프의 유일한 태그다.


### <th:block>
- 일반적인 반복 th:each로 해결하지 못하는 상황에서 사용한다.
- 타임리프 렌더링 후 사라진다.

-----------------------------------------------------------------------------------------------------------------------------

> ## 자바스크립트 인라인.

### 개요.
    <script th:inline="javascript">
- 타임리프는 자바스크립트에서 타임리프를 편리하게 사용할 수 있는 자바스크립트 인라인 기능을 제공한다.


### 기본 script.
    <script> 
        var username1 = [[${user.username}]]
        var username2 = /* [[${user.username}]] */ "테스트 유저네임";
    </script>
- 값이 그대로 나온다.
- 객체의 경우 toString()의 값이 나온다.

### 자바스크립트 인라인.
    <script th:inlin="javascript">
        var username1 = [[${user.username}]] 
        var username2 = /*[[${user.username}]]*/ "테스트 유저네임";
    </script>
- String 타입의 값인 경우 ""로 감싸져서 나온다.
- 내츄럴 템플릿이 가능해서 주석으로 감싼 타임리프 값이 렌더링되면 "테스트 유저네임"이 사라진다. (띄어쓰기 금지)
- 객체의 경우 JSON 형태로 데이터를 보여준다.


### 텍스트 렌더링.
- 인라인 스크립트 안에서 String 타입에 데이터가 넘어오면 ""를 자동으로 붙여준다.
- 자바스크립트에서 문제가 될 수 있는 문자가 포함되어 있으면 이스케이프 처리도 해준다.
  - 예) " -> \" 로 처리해준다.


### 네츄럴 템플릿.
- HTML 파일을 직접 열어도 동작하는 내추럴 템플릿 기능을 제공한다.
- 자바스크립트 인라인 기능을 상요함녀 주석을 활용해서 이 기능을 사용할 수 있다.


### 객체.
- 자바스크립트 인라인 안에서 객체가 넘어오면 JSON으로 자동으로 변환해준다.


### 자바스크립트 반복문.
    <script th:inline="javascript">
        [# th:each="user, stat : ${users}"]
            var user[[${stat.count}]] = [[${user}]];
        [/]
    </script>

-----------------------------------------------------------------------------------------------------------------------------

> ## 템플릿 조각.

### 개요.
- 웹 페이지를 개발할 때는 공통 영역이 많이 있다.
- 예를 들어서 상단 영역, 하단 영역, 좌측 카테고리 등등 여러 페이지에서 함께 사용하는 영역들이 있다.
- 이런 부분을 코드를 복사해서 사용한다면 변경시 여러 페이지를 다 수정해야 하므로 상당히 비효율적이다.
- 타임리프는 이런 문제를 해결하기 위해 템플릿 조각과 레이아웃 기능을 지원한다.


### insert.
    <div th:insert="~{/경로 :: 이름}"></div>
- div 태그 안에 템플릿 조각을 추가한다.


### replace.
    <div th:replace="~{/경로 :: 이름}"></div>
- div 태그를 템플릿 조각으로 대체한다.


### 템플릿 파편 만들기.
    <footer th:fragment="이름"></footer>
    <footer th:fragment="이름(변수1, 변수2)">
      <p th:text="${변수1}"></p>
    </footer>
- 이름으로 구분되는 템플릿 파편을 만들 수 있다.
- 템플릿 파편에 파라미터를 넘겨서 사용할 수 있다.

-----------------------------------------------------------------------------------------------------------------------------

> ## 템플릿 레이아웃1.

### 개요.
- 이전에는 일부 코드 조각을 가지고와서 사용했다면, 이번에는 개념을 더 확장해서 코드 조각을 레이아웃에 넘겨서 사용하는 방법에 대해 알아보자.
- 예를 들어 <head>를 공통으로 사용하는 같은 정보들이 있는데, 이런 공통 정보를 한 곳에 모아두고 사용하지만 페이지마다 더 추가해서 사용하고 싶은 경우.


### comon_hedear(~{::title}, ~{::link})
- "::title"은 현재 페이지의 title 태그들을 전달한다.
- "::link"는 현재 페이지의 link 태그들을 전달한다.


### 정리.
- 공통 부분은 그대로 유지되고, 추가 부분에 전달한 link 태그들이 포함된 것을 알 수 있다.
- 레이아웃 개념을 두고, 그 레이아웃에 필요한 코드 조각을 전달해서 완성하는 것으로 이해하면 된다.

-----------------------------------------------------------------------------------------------------------------------------

> ## 템플릿 레이아웃2.

### 개요.
- head 태그에만 적용하는게 아니라 html 전체에 적용할 수 있다.


### 정리.
    // 템플릿 조각 만들기.
    <html th:fragment="이름(파라미터1, 파라미터2)" xmlns:th="...">...</html>
    
    // 템플릿 조각 사용하기.
    <html th:replace="~{/template/layoutExtend/layoutFile :: 이름(~{::태그이름1}, ~{::태그이름2})}" ... > ... </html>

-----------------------------------------------------------------------------------------------------------------------------

> ## 타임리프 최종 정리.

### 타임리프 특징.
- 서버 사이드 HTML 렌더링.
- 네츄럴 템플릿.
- 스프링 통합 지원.


### 간단한 표현식.
- 변수 표현식 : ${...}
- 선택 변수 표현식 : *{...}
- 메시지 표현식 : #{...}
- 링크 URL 표현식 : @{...}
- 조각 표현식 : ~{...}


### 이스케이프.
- th:text : 타임리프 텍스트 사용. (이스케이프 O)
- th:utext : 이스케이프를 하지 않는 타임리프 텍스트 사용. (이스케이프 X)


### 날짜 관련.
    <span th:text="${#temporals.format(localDateTime, 'yyyy-MM-DD')}"></span>


### 문자 리터럴.
- 띄어쓰기가 있는 문자 리터럴은 '' 작은 따옴표로 감사야 한다.


### No-Operation.
- '_'인 경우 타임리프가 존재하지 않는 것처럼 동작한다. (HTML이 그대로 보여진다)


### if문 주의사항.
- if문이 false인 경우 태그 자체가 사라진다.


### block.
- each 반복문만으로 해결하지 못하는 경우 사용한다.


### 인라인 자바스크립트.
- 자바스크립트에서 타임리프 문법을 사용하는 경우 무조건 사용하자!











