
# 데이터 접근 기술 - 활용 방안

---------------------------------------------------------------------------------------------------------------------------------

> ##  스프링 데이터 JPA 예제와 트레이드 오프

### 고민
- 구조를 맞추기 위해서, 중간에 어댑터가 들어가면서 전체 구조가 너무 복잡해지고 사용하는 클래스도 많아지는 단점이 생겼따
- 실제 이 코드를 구현해야하는 개발자 입장에서 보면 중간에 어댑터도 만들고, 실제 코드까지 만들어야 하는 불편함이 생긴다
- 유지보수 관점에서 ItemService를 변경하지 않고, ItemRepository의 구현체를 변경할 수 있는 장점이 있다
- 반면에, 구조가 복잡해지면서 어댑터 코드와 실제 코드까지 함께 유지보수 해야 하는 어려움도 발생한다


### 다른 선택
- 여기서 완전히 다른 선택을 할 수도 있다
- ItemService 코드를 일부 코쳐서 직접 스프링 데이터 JPA를 사용하도록 할 수도 있다
- DI, OCP 원칙을 포기하는 대신에, 복잡한 어댑터를 제거하고, 구조를 단순하게 가져갈 수 있는 장점이 있다


### 트레이드 오프
- 개발을 할 때는 항상 자원이 무한한 것이 아니다
- 어설픈 추상화는 오히려 독이 되는 경우도 많다
- 무엇보다 추상화도 비용이 든다


### 결론
- 추상화 비용을 넘어설 만큼 효과가 있을 때 추상화를 도입하는 것이 실용적이다
- 김영한님 조언
  - 추상화와 간단하게 짜는 것 중에 고민이 된다면 우선 간단하게 짜고 나중에 리팩토링을 하는 것이 더 좋다고 생각 

---------------------------------------------------------------------------------------------------------------------------------

> ## 실용적인 구조

### 개요
- 스프링 데이터 JPA의 기능은 최대한 살리면서, QueryDSL도 편리하게 사용할 수 있는 구조를 만들어보겠다


### 변경
- 추상화되어 있는 ItemRepository를 제거하고 Service에서 직접 ItemRepository 구현체를 DI받아서 사용


### 참고
- 스프링 데이터 JPA가 제공하는 커스텀 리포지토리를 사용해도 비슷하게 문제를 해결할 수는 있다

---------------------------------------------------------------------------------------------------------------------------------

> ## 다양한 데이터 접근 기술 조합

### 개요
- 어떤 데이터 접근 기술을 선택하는 것이 좋을까?
- 이 부분은 하나의 정답이 있다기 보다는, 비즈니스 상황과, 현재 프로젝트 구성원의 역량에 따라서 결정하는 것이 맞다 생각한다


### 트랜잭션 매니저 선택
- JPA, 스프링 데이터 JPA, QueryDSL은 모두 JPA 기술을 사용하는 것이기 때문에 JpaTransactionManager를 사용
- JdbcTemplate, MyBatis와 같은 기술들은 내부에서 JDBC를 직접 사용하기 때문에 DataSourceTransactionManager를 사용한다
- JpaTransactionManager의 다양한 지원
  - JpaTransactionManager는 DataSourceTransactionManager가 제공하는 기능도 대부분 제공한다
  - 결과적으로 JpaTransactionManager를 하나만 스프링 빈에 등록하면, JPA, JdbcTemplate, MyBatis 모두를 트랜잭션으로 사용할 수 있다


### 주의점
- JPA를 통해 데이터를 변경한 다음에 JdbcTemplate을 호출하는 경우 JdbcTemplate에서는 JPA가 변경한 데이터를 읽지 못하는 문제가 발생한다
- 이 문제를 해결하려면 JPA 호출이 끝난 시점에 JPA가 제공하는 플러시라는 기능을 사용해서 JPA의 변경 내역을 DB에 반영해주어야 한다





























