
# 조건부 자동 구성

------------------------------------------------------------------------------------------------------------------------------------

> ## 스타터와 Jetty 서버 구성 추가

### gradle tree 확인
    ./gradlew dependencies --configuration compileClasspath

------------------------------------------------------------------------------------------------------------------------------------

> ## @Conditional과 Condition

### @Conditional
- 이 빈이 조건에 따라 적용될지 말지 결정할 수 있는 어노테이션
- Condition 인터페이스를 구현한 클래스를 입력해야 한다


### Condition 인터페이스
- 구현체에서 matches() 메서드에서 boolean 값을 반환하여 조건을 작성할 수 있다
- @Conditional에 구현체를 등록하면, matches() 메서드의 true, false에 따라 빈이 조건부로 등록될 수 있다
- 메서드, 클래스에 붙을 수 있다

------------------------------------------------------------------------------------------------------------------------------------

> ## @Conditional 학습테스트

### matches()
- 파라미터
  - ConditionContext
    - getRegistry()를 통해 BeanDefinitionRegistry로 빈 정의를 확인한다 (빈의 존재를 확인하고, 빈 프로퍼티를 발굴한다)
    - getEnviroment()로 부터 얻은 Enviroment를 통해 환경 변수 값을 확인한다
    - getResourceLoader()에서 반환된 ResourceLoader를 통해 로드된 자원 내용을 읽고 검사한다
    - getClassLoader()에서 반환된 ClassLoaader를 통해 클래스의 존재를 로드하고 확인한다
  - AnnotatedTypeMetadata
    - isAnnotated() 메서드를 사용하여, @Bean 메서드가 특정 어노테이션 타입을 사용해 어노테이션을 붙일 수 있는지 검사할 수 있다
    - getAllAnnotationAttributes() 메서드를 사용하여 모든 어노테이션 어트리뷰트를 가져온다

------------------------------------------------------------------------------------------------------------------------------------

> ## 커스텀 @Conditional

### gradle 활용
    implementation('org.springframework.boot:spring-boot-starter-web') {
      exclude group: 'org.springframework.boot', module: 'spring-boot-starter-tomcat'
    }
- 자동 추가된 라이브러리 제거하기

------------------------------------------------------------------------------------------------------------------------------------

> ## 자동 구성 정보 대체하기

### @ConditionalOnMissingBean
    @Bean
    @CondtionalOnMissingBean
    ...
- 같은 타입의 빈이 등록되어 있으면 빈을 등록하지 않음

------------------------------------------------------------------------------------------------------------------------------------

> ## 스프링 부트의 @Conditional

### Class Conditions
- 클래스, 메서드에 모두 사용할 수 있지만, 클래스에서 먼저 체크해 주는 것이 좋다


### Bean Conditions
- 빈의 존재 여부를 기준으로 포함 여부를 결정한다
- 빈의 타입 또는 이름을 지정할 수 있다
- 지정된 빈 정보가 없으면 메소드의 리턴 타입을 기준으로 빈의 존재 여부를 체크한다
- 자동 구성 사이에 적용하려면 @Configuration 클래스의 적용 순서가 중요하다
- 개발자가 직접 정의한 커스텀 빈 구성 정보가 자동 구성 정보 처리보다 우선하기 때문에 이 관계에 적용하는 것은 안전하다
- 반대로 커스텀 빈 구성 정보에 적용하는 건 피해야 한다


### 주의
- 클래스의 존재로 해당 기술의 사용 여부를 확인하고, 직접 추가한 커스텀 빈 구성의 존재를 확인해서 자동 구성의 빈 오브젝트를 이용할지 최종 결정


### Property Conditions
- @ConditionalOnProperty는 스프링 환경 프로퍼티 정보를 이용한다
- 지정된 프로퍼티가 존재하고 값이 false가 아니면 포함 대상이 된다
- 프로퍼티의 존재를 확인해서 빈 오브젝트를 추가하고, 해당 빈 오브젝트에서 프로퍼티 값을 이용해서 세밀하게 빈 구성을 할 수 있다


### Resource Conditions
- @ConditionalOnResource는 지정된 리소스(파일)의 존재를 확인하는 조건이다


### Web Application Conditions
- @ConditionalOnWebApplication
- @ConditionalOnNotWebApplication
- 웹 어플리케이션 여부를 확인한다, 모든 스프링 부트 프로젝트가 웹 기술을 사용해야 하는 것은 아니다


### SpEL Expression Conditions
- @ConditionalOnExpression은 스프링 SpEL(스프링 표현식)의 처리 결과를 기준으로 판단한다, 매우 상세한 조건 설정이 가능하다














