
# 외부 설정을 이용한 자동 구성

--------------------------------------------------------------------------------------------------------------------------------------

> ## Environment 추상화와 프로퍼티

### Environment Abstraction-Properties
- StandardEnvironment
  - System Properties (Java - 4)
  - System Environment Variables (OS 환경변수 - 5)
- StandardServletEnvironment
  - ServletConfig Parameters (1)
  - ServletContext Parameters (2)
  - JNDI (Java EE 표준 - 3)
- @PropertySource (property 정보 읽어오기 - 6)
- SpringBoot
  - application.properties, xml, yml (property 정보 읽어오기 - 7)


### 이름 확인
    Environment.getProperty("property.name")
- property.name, property_name, PROPERTY.NAME, PROPERTY_NAME 4가지 모두 확인

--------------------------------------------------------------------------------------------------------------------------------------

> ## 자동 구성에 Environment 프로퍼티 적용

### ApplicationRunner 인터페이스
- 구현체에서 run() 메서드를 작성하면, 컨테이너의 모든 초기화가 끝난 후에 실행한다


### Environment 인터페이스
- 스프링 환경, 설정과 관련된 인터페이스 (Profiles, Property 설정에 접근)
- 빈으로 등록되어 있어 빈 등록시 파라미터로 DI 받을 수 있다

--------------------------------------------------------------------------------------------------------------------------------------

> ## @Value와 PropertySourcesPlaceholderConfigurer

### PropertySourcesPlaceholderConfigurer 클래스
    @Value("${context}")
- 빈 후처리기에 의해 위에 값을 Property에서 자동으로 읽어 옴
- PlaceholderConfigurerSupport를 구현한 클래스
- PropertySource를 추가하여 @Value 어노테이션의 ${...} 부분에 프로퍼티 값을 주입해준다
- Bean으로 등록해서 사용하며, PropertySource를 여러개 등록할 수 있다
- 프로퍼티가 겹칠 땐 먼저 등록된 PropertySource의 프로퍼티가 우선순위를 갖는다

--------------------------------------------------------------------------------------------------------------------------------------

> ## 프로퍼티 클래스의 분리

### @Value 기본값 설정
    @Value(${port:8080})
- properties에 port 정보가 입력되지 않으면, 8080을 기본값으로 사용함


### Binder 클래스
    ServerProperties proeprties = Binder.get(environment).bind("", 클래스이름.class).get(); 
- Properties 클래스를 읽어올 때 사용할 수 있다


### 스프링 부트
- ServerProperties 프로퍼티 클래스를 통해 Property를 어떻게 읽어 오는지 확인할 수 있다

--------------------------------------------------------------------------------------------------------------------------------------

> ## 프로퍼티 빈의 후처리기 도입

### Binder 클래스
    Binder.get(environment).bindOrCreate(prefix, bean.getClass());
- prefix : properties에서 prefix를 확인할 수 있다


### DeferredImportSelector 인터페이스
- @Config, @Component 클래스의 Bean 설정이 끝난 후에 ImportSelector가 전달받은 구성정보들을 Bean으로 등록한다
- @Import 클래스에 DeferredImportSelector 구현체 클래스를 작성해서 사용한다
- selectImports(AnnotationMetadata importingClassMetadata) 메서드
  - 어노테이션 클래스를 기반으로 가져와야 하는 클래스의 이름을 선택하고 반환한다





























