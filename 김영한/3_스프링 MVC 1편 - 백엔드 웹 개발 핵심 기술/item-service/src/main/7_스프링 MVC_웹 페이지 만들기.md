
# 스프링 MVC 웹 페이지 만들기.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

> ## 요구사항 분석.

### 그래들 설정.
- settings -> gradle -> intelliJ로 변경.

### 요구사항 분석.
- 상품 관리 기능.
  - 상품 목록.
  - 상품 상세.
  - 상품 등록.
  - 상품 수정.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

> ## 상품 도메인 개발.

### 리턴 값을 한 번 감싸서 하는 이유.
    public List<Item> findAll() {
      return new ArrayList<>(store.values());
    }
- 나중에 반환값에 추가적으로 요소를 넣더라고 stroe에 변경이 일어나지 않도록 만들기 위해.

### DTO.
- 명확성을 위해 상황에 맞게 DTO를 많이 만들어 주는 것이 좋다.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

> ## 상품 서비스 HTML.

### 정적 리소스 확인 방법.
1. 서버 켜서 경로.
2. 실제 파일 경로.

### 참고.
- 실제 운영서버에서는 HTML의 파일 경로를 통해 접근하는 것을 막아야 한다.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

> ## 상품 목록 - 타임 리프.

### 타임리프 간단히 알아보기.
    <html xmlns:th="http://www.thymleaf.org">

### 속성 변경.
    th:href="@{/경로}"
- 타임리프 뷰 템플릿을 거치면 th:href를 사용하고 거치지 않으면 그냥 href를 사용한다.

### 타임리프 핵심.
- th:xxx가 붙은 부분은 서버사이드에서 렌더링 되고, 기존 것을 대체한다.
- th:xxx가 없으면 기존 html의 속성이 그대로 사용된다.
- 따라서 HTML을 파일 보기를 유지하면서 템플릿 기능도 할 수 있다.

### URL 링크 표현식.
    "@{/경로}"
- URL 링크 표현식을 사용하면 서블릿 컨텍스트를 자동으로 포함한다.

### 리터럴 대체.
    '|문자|'
    "|location.href='@{/basic/...}'|"
- 타임리프에서 문자와 표현식 등은 분리되어 있기 때문에 더해서 사용해야 한다.

### 반복 출력.
    <tr th:each="item : ${items}">

### 변수 표현식.
    <td th:text="${item.price}">1000<td>
- 모델에 포함된 값이나, 타임리프 변수로 선언한 값을 조회할 수 있다.
- 프로퍼티 접근법을 사용한다. (getter)

### 내용 변경.
    <td th:text="${item.price}">1000<td>
- 내용의 값을 th:text 의 값으로 변경한다.

### URL 링크 표현식2.
    th:href="@{/basic/items/{itemId}(itemId=${item.id})}"
- 경로 변수뿐만 아니라 쿼리 파라미터로 생성한다.

### 참고.
- 타임리프는 순수 HTML을 파일을 웹 브라우저에서 열어도 내용을 확인할 수 있다.
- 서버를 통해 뷰 템플릿을 거치면 동적으로 변경된 결과를 확인할 수 있다.
- 이렇게 순수 HTML을 그대로 유지하면서 뷰 템플릿도 사용할 수 있는 특징을 '네츄럴 템플릿 natural templates'이라 한다.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

> ## 상품 상세.

### 같은 url.
    th:action
- action 값을 작성하지 않으면 같은 url에 보내는 것을 의미한다.

### @ModelAttribute.
- 요청 파라미터 처리.
- 객체를 생성하고, 요청 파라미터의 값을 프로퍼티 접근법(setter)로 입력해준다.
- 모델에 @ModelAttribute로 지정한 객체를 자동으로 넣어준다.
- 지금 코드를 보면 model.addAttribute("item", item)가 주석처리 되어 있어도 잘 동작하는 것을 볼 수 있다.
- @ModelAttribute를 생략하면 타입의 첫글자만 소문자로 바꾼 값이 model에 담긴다.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

> ## 상품 수정.

### redirect.
    return "redirect:/url/{pathVariable}"
- 컨트롤러에 매핑된 @PathVariable의 값은 redirect {pathVariable}에서 사용할 수 있다.
- HTML Form 전송은 PUT, PATCH를 지원하지 않는다. (PUT, PATCH는 HTTP API 전송시에 사용)
- 스프링에서 HTTP POST로 Form 요청할 때 히든 필드를 통해서 PUT, PATCH 매핑을 사용하는 방법이 있지만, HTTP 요청상 POST 요청이다.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

> ## PRG Post/Redirect/Get.

### 저장했을 때 forward 했을 때 문제점.
- post로 보낸 parameter 정보들이 그대로 남아있기 때문에 새로고침을 누르면 같은 내용이 계속 반영된다.

### 문제 해결 방법.
- Post/Redirect/Get.
  - post 데이터를 처리한 후에 redirect를 발생시켜 parameter 데이터를 초기화한다.

### 참고.
    "redirect:/url/" + item.getId();
- 위에 처럼 작성하면 변수 값이 URL 인코딩이 안되기 때문에 위험하다.
- 다음에 설명하는 RedirectAttributes를 사용하자.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

> ## RedirectAttributes.

### 개요.
- 저장이 잘 되었을 때 "저장되었습니다" 와 같은 알림창이 뜨도록 만들고 싶다.

### RedirectAttributes.
- redirect.addAttribute()를 통해 redirect될 때 parameter로 값을 넣어줄 수 있다.

### 타임리프 파라미터 사용하기.
    th:if="{param.파라미터이름}"

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

> ## 다음으로.
















