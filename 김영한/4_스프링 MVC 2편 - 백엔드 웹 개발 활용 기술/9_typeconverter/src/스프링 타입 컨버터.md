
# 스프링 타입 컨버터.

------------------------------------------------------------------------------------------------------------------------------------

> ## 스프링 타입 컨버터 소개.

### 분석.
    String data = request.getParameter("data")
    Integer intValue = Integer.valudOf(Data);
- HTTP 요청 파라미터는 모두 문자로 처리된다.
- 따라서 요청 파라미터를 자바에서 달느 타입으로 변환해서 사용하고 싶으면 숫자 타입으로 변환하는 과정을 거쳐야 한다.


### 스프링 타입 변환 적용 예.
- 스프링 MVC 요청 파라미터.
  - @RequestParam, @ModelAttribute, @PathVariable.
- @Value 등으로 YML 정보 읽기.
- XML에 넣은 스프링 빈 정보를 변환.
- 뷰를 렌더링 할 때


### 스프링과 타입 변환.
- 스프링이 중간에 타입 변환기를 사용해서 타입을 "String -> Integer"로 변환해주었기 땜누에 개발자는 편리하게 해당 타입을 바로 받을 수 있다.
- 만약 개발자가 새로운 타입을 만들어서 변환하고 싶으면 어떻게 하면 될까?


### 스프링 컨버터.
- 스프링은 확장 가능한 컨버터 인터페이스를 제공한다.
- 개발자는 스프링에 추가적인 타입 변환이 필요하면 이 컨버터 인터페이스를 구현해서 등록하면 된다.


### 참고.
- 과거에는 "PropertyEditor"라는 것으로 타입을 변환했다.
- "PropertyEditor"는 동시성 문제가 있어서 타입을 변환할 때마다 객체를 계속 생성해야 하는 단점이 있다.
- "Converter"의 등장으로 해당 문제들이 해결되었다.

------------------------------------------------------------------------------------------------------------------------------------

> ## 타입 컨버터 - Converter.

### 참고.
- 스프링은 용도에 따라 다양한 방식의 타입 컨버터를 제공한다.


### 다양한 타입 컨버터
- Converter : 기본 타입 컨버터.
- ConverterFactory : 전체 클래스 계층 구조가 필요할 때.
- GenericConverter : 정교한 구현, 대상 필드의 어노테이션 정보 사용 가능.
- ConditionalGenericConverter : 특정 조건이 참인 경우에만 실행.


### 참고.
- 스프링은 문자, 숫자, boolean, Enum 등 일반적인 타입에 대한 대부분의 컨버터를 제공한다.

------------------------------------------------------------------------------------------------------------------------------------

> ## 컨버전 서비스 - ConversionService.

### 등록과 사용 분리.
- 컨버터를 등록할 때는 타입 컨버터를 명확하게 알아야 한다.
- 반면 컨버터를 사용하는 입장에서는 타입 컨버터를 전혀 몰라도 된다.
- 타입을 변환을 원하는 사용자는 컨버전 서비스 인터페이스에만 의존하면 된다.


### 인터페이스 분리 원칙 ISP Interface Segregation Principal.
- 인터페이스 분리 원칙은 클라이언트가 자신이 이용하지 않는 메서드에 의존하지 않아야 한다.


### DefaultConversionService 부모 인터페이스.
- ConversionService : 컨버터 사용에 초점.
- ConverterRegistry : 컨버터 등록에 초점.

------------------------------------------------------------------------------------------------------------------------------------

> ## 스프링에 Converter 적용하기.

### 컨버터 등록.
    @Configuration
    class WebConfig implements WebMvcConfigurer {
      
      @Override
      public void addFormatters(FormatterRegistry registry) {
        registry.addConverter(컨버터 클래스);
      }

    }


### 컨버터를 등록하지 않아도 컨버터가 된다.
- 스프링이 내부에서 수 많은 기본 컨버터들을 제공한다.
- 컨버터를 등록하면 스프링 기본 컨버터보다 우선순위를 가진다.


### 처리 과정.
- "@RequestParam"은 "RequestParamMethodArgumentResolver"에서 "ConversionService"를 사용해서 타입을 변환한다. 
- 부모 클래스와 다양한 외부 클래스를 호출하는 등 복잡한 내부 과정을 거치기 때문에 대략 이렇게 처리되는 것으로 이해해도 충분하다.

------------------------------------------------------------------------------------------------------------------------------------

> ## 뷰 템플릿에 컨버터 적용하기.

### 타임리프 뷰 컨버터.
    ${{...}}
- 위와 같은 방식을 사용하면 자동으로 커버전 서비스를 사용해서 변환된 결과를 출력해준다.


### 예제.
- ${{number}}
  - 뷰 텔플릿은 데이터를 문자로 출력한다.
  - 컨버터를 적용하게 되면 Integer 타입인 10000을 String 타입으로 변환하여 실행된다.
- ${{ipPort}}
  - 컨버터를 적용하게 되면 IpPort 타입을 String 타입으로 변환한다.


### 자동으로 컨버터가 적용되는 방법.
1. ${{...}}
2. th:field

------------------------------------------------------------------------------------------------------------------------------------

> ## 포매터 - Formatter.

### 개요.
- "Converter"는 입력과 출력 타입에 제한이 없는, 범용 타입 변환 기능을 제공한다.
- 그러나, 개발자 입장에서는 문자를 다른 타입으로 변환하거나, 다른 타입을 문자로 변환하는 상황이 대부분이다.


### 포매터.
- 객체를 특정한 포맷에 맺추어 문자로 출력하거나 또는 그 반대의 역할을 하는 것에 특화된 기능을 의미한다.


### Converter vs Formatter.
- Converter : 범용(객체 -> 객체 가능)
- Formatter : 문자에 특화(객체 -> 문자, 문자 -> 객체) + 현지화(Locale)
  - "Converter"의 특별한 버전.


### 포매터 만들기.
- 포매터는 객체를 문자로 변경하고, 문자를 객체로 변경하는 두 가지 기능을 모두 수행한다.
  - String print(T object, Local locale) : 객체를 문자로 변경.
  - T parse(String text, Local locale) : 문자를 객체로 변경.


### NumberFormat.
- 숫자 중간에 쉼표가 적용한 경우 사용한다.
- 이 객체는 Locale 정보를 활용해서 나라별로 다른 숫자 포맷을 만들어준다.
- parse() : 문자를 숫자로 변환한다.
- print() : 객체를 문자로 변환한다.


### 참고.
- 스프링은 용도에 따라 다양한 방식의 포맷터를 제공한다.

------------------------------------------------------------------------------------------------------------------------------------

> ## 포맷터를 지원하는 컨버전 서비스.

### 개요.
- 생각해보면 포맷터는 객체 -> 문자, 문자 -> 객체로 변환하는 특별한 컨버턷일 뿐이다.


### 포맷터를 등록하는 방법.
- "FormattingConversionServer"는 포맷터를 지원하는 컨버전 서비스이다.
- "DefaultFormattingConversionService"는 "FormattingConversionService"에 기본적인 통화, 숫자 관련 몇가지 기본 포맷터를 추가해서 제공.


### DefaultFormattingConversionService 상속 관계.
- "FormattingConversionService"는 "ConversionService" 관련 기능을 상속받기 때문에 컨버터, 포맷터 모두 등록할 수 있다.
- 사용할 때는 "ConversionService"가 제공하는 convert()만 사용하면 된다.


### 참고.
- 스프림 부트는 "DefaultFormattingConversionService"를 상속받은 "WebConversionService"를 내부에서 사용한다.

------------------------------------------------------------------------------------------------------------------------------------

> ## 포맷터 적용하기.

### 우선순위.
1. 컨버터
2. 포맷터

------------------------------------------------------------------------------------------------------------------------------------

> ## 스프링이 제공하는 기본 포맷터.

### 개요.
- 스프링은 자바에서 기본으로 제공하는 타입들에 대해 수 많은 포맷터를 기본으로 제공한다.
- 포맷터는 기본 형식이 지정되어 있기 때문에, 객체의 각 필드마다 다른 형식을 지정하기 어렵다.


### 스프링이 제공하는 포맷터 어노테이션.
- @NumberFormat : 숫자 관련 지정 포맷터.
- @DateTimeFormat : 날짜 관련 지정 포맷터.

------------------------------------------------------------------------------------------------------------------------------------

> ## 정리.

### 참고.
- 컨버터를 사용하든, 포맷터를 사용하든 등록 방법은 다르지만, 사용할 떄는 컨버전 서비스를 통해서 일관성 있게 사용할 수 있다.


### 주의.
- 메시지 컨버터 "HttpMessageConverter"에는 컨버전 서비스가 적용되지 않는다.
- 컨버전 서비스는 @RequestParam, @ModelAttribute, @PathVariable, 뷰 템플릿 등에서 사용할 수 있다.







