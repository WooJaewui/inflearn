
# 다양한 연관관계 매핑

----------------------------------------------------------------------------------------------------------------------------------

> ## 다대일 [N:1]

### 다중성
- @ManyToOne : 다대일
- @OneToMany : 일대다
- @OneToOne : 일대일
- @ManyToMany : 다대다


### 단방향, 양방향
- 테이블
  - 외래 키 하나로 양쪽 조인 가능
  - 사실 방향이라는 개념이 없음
- 객체
  - 참조용 필드가 있는 쪽으로만 참조 가능
  - 한쪽만 참조하면 단방향
  - 양쪽이 서로 참조하면 양방향


### 연관관계의 주인
- 객체 양방향 관계는 참조가 2군데 있음, 둘 중 테이블의 외래키를 관리할 곳을 지정해야 함
- 연관관계의 주인은 외래키를 관리하는 참조
- 주인의 반대편은 외래키에 영향을 주지 않음, 단순 조회만 가능


### mappedBy
    @OneToMany(mappedBy = "변수명")
- 연관관계의 주인 변수이름을 넣어준다

----------------------------------------------------------------------------------------------------------------------------------

> ## 일대다 [1:N]

### 일대다 연관관계의 주인
- 1에 연관관계 주인을 주는 경우를 의미한다


### 일대다 단방향 정리
- 일대다 단방향은 일대다(1:N)에서 1이 연관과계의 주인임
- 테이블에서는 항상 다(N) 쪽에 외래키가 있음
- @JoinColumn을 사용하지 않으면, 중간에 테이블이 하나 생성된다 (@JoinTable)
- 단점
  - 엔티티가 관리하는 외래키가 다른 테이블에 있음
  - 연관관계 관리를 위해 추가로 UPDATE SQL 실행


### 최종
- 일대다 단방향 매핑보다는 다대일 양방향 매핑을 사용하자


### 일대다 양방향 정리
    @JoinColumn(insertable=false, updatable=false)
- 이런 매핑은 공식적으로 존재 X
- 읽기 전용 필드를 사용해서 양방향처럼 사용하는 방법

----------------------------------------------------------------------------------------------------------------------------------

> ## 일대일 [1:1]

### 일대일 관계
- 주 테이블이나 대상 테이블 중에 외래키 선택 가능
  - 주 테이블에 외래키
  - 대상 테이블에 외래키
- 외래키에 DB 유니크 제약조건 추가


### 일대일 주의사항
- 연관관계 주인이 아닌 참조 엔티티에 외래키가 있는 경우는 사용할 수 없다

----------------------------------------------------------------------------------------------------------------------------------

> ## 다대다 [N:M]

### 다대다
- 관계형 DB는 정규화된 테이블 2개로 다대다 관계를 표현할 수 없음
- 연결 테이블을 추가해서 일대다, 다대일 관계로 풀어내야 함


### 다대다 한계 극복
- 연결 테이블용 엔티티를 추가해서 사용
- @ManyToMany -> @OneToMany, @ManyToOne

----------------------------------------------------------------------------------------------------------------------------------

> ## 실전 예제 3 - 다양한 연관관계 매핑

### N:M 관계는 1:N, N1:로
- 실전에서는 @ManyToMany 사용 X


### @JoinColumn
- 외래 키를 매핑할 때 사용
- 속성
  - name : 매핑할 외래 키 이름
  - referencedColumnName : 외래키가 참조하는 대상 테이블의 컬럼명
  - foreignKey(DDL) : 외래키 제약조건을 직접 지정할 수 있다
  - unique, nullable insertable, updatable, ...


### @ManyToOne
- 다대일 관계 매핑
- 속성
  - optional : false로 설정하면 연관된 엔티티가 항상 있어야 한다
  - fetch : 글로벌 페치 전략을 설정
  - cascade : 영속성 전이 기능을 사용한다
  - targetEntity : 연관된 엔티티의 타입 정보를 설정


### @OneToMany
- 다대일 관계 매핑
- 속성
  - mappedBy : 연관관계의 주인 필드를 설정
  - fetch : 글로벌 페치 전략을 설정
  - cascade : 영속성 전이 기능을 사용한다
  - targetEntity : 연관된 엔티티의 타입 정보를 설정






























