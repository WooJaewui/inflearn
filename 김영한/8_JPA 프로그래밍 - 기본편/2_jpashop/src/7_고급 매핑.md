
# 고급 매핑

----------------------------------------------------------------------------------------------------------------------------------

> ## 상속관계 매핑

### 상속관계 매핑
- 객체의 상속과 구조와 DB의 슈퍼타입 서브타입 관계를 매핑


### @Inheritance JOINED
    @Inheritance(strategy = InheritanceType.JOINED)
- 상속 관계 전략을 지정할 수 있다
- JOINED : Join 형태로 테이블이 나눠진다


### @Inheritance SINGLE_TABLE
    @Inheritance(strategy = InheritanceType.SINGLE_TABLE)
- 테이블 하나로 상속 관계를 모두 표현
- 테이블에 DTYPE 컬럼이 꼭 생성된다


### @Inheritance TABLE_PER_CLASS
    @Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)
- 부모 테이블 없이 테이블을 생성하고, 공통 된 컬럼을 갖는다
- 부모 클래스를 abstract로 만들어야 한다
- @DicriminatorColumn을 넣어도 DTYPE column이 생성되지 않는다
- 조회 성능이 매우 떨어진다


### @DiscriminatorColumn
    @DiscriminatorColumn(value = "컬럼 이름")
- 테이블에 DTYPE 컬럼이 생성되고, 어떤 테이블 때문에 저장되었는지 알 수 있다
- @DiscriminatorValue("BB") : DTYPE에 들어갈 값 (자식 테이블에 선언) 


### 장단점
- 조인 전략
  - 장점
    - 테이블이 전규화 되어 있다
    - 외래키를 참조 무결성 제약조건을 활용할 수 있다
    - 저장공간 효율화
  - 단점
    - 조회 시 조인을 많이 사용, 성능 저하
    - 조회 쿼리가 복잡함
    - 데이터 저장시 INSERT SQL 2번 호출
- SINGLE_TABLE 전략
  - 장점
    - 조인이 필요 없으므로 일반적으로 조회 성능이 빠름
    - 조회 쿼리가 단순함
  - 단점
    - 자식 엔티티가 매핑한 컬럼은 모두 null 허용
    - 테이블이 커질 수 있고, 상황에 따라서 조회 성능이 오히려 느려질 수 있다 (이런 상황은 거의 없다)
- TABLE_PER_CLASS 전략
  - 왠만하면 사용하지 말자
  - 장점
    - 서브 타입을 명확하게 구분해서 처리할 때 효과적
    - NOT NULL 제약조건 사용 가능
  - 단점
    - 여러 자식 테이블을 함께 조회할 때 성능이 느림 (UNION)
    - 자식 테이블을 통합해서 조회하기 어렵다
    - 변경이 어렵다

----------------------------------------------------------------------------------------------------------------------------------

> ## Mapped Superclass - 매핑 정보 상속

### @MappedSuperclass
- 공통 매핑 정보가 필요할 때 사용
  - DB는 각각 다른 테이블


### @MappedSuperclass 상세
- 상속관계 매핑 X
- 엔티티 X, 테이블과 매핑 X
- 부모 클래스를 상속 받는 자식 클래스에 매핑 정보만 제공 (조회, 검색 불가)
- 직접 생성해서 사용할 일이 없으므로 추상 클래스 권장
- 주로 등록일, 수정일 등 같은 전체 엔티티에서 공통으로 적용하는 정보에 사용


### 참고
- @Entity 클래스는 엔티티나, @MappedSuperclass로 지정한 클래스만 상속 가능

----------------------------------------------------------------------------------------------------------------------------------

> ## 실전 예제 4 - 상속관계 매핑

### 상속관계의 장단점
- 싱글 테이블, 조인 전략에는 트레이드 오프가 존재하기 때문에 상황에 맞게 잘 사용하자




























