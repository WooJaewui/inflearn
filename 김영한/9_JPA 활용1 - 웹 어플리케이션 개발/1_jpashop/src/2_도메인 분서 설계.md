
# 도메인 분석 설계

---------------------------------------------------------------------------------------------------------------------------------------

> ## 도메인 모델과 테이블 설계

### 실무와 예제
- 실무에서는 사용하지 않는 예제들이 있다
- 다대다 연관 관계 : 관계해소 해야 됨 (1:다, 다:1)
- 양방향 연관 관계 매핑 : 왠만하면 단방향으로 만들자


### 참고1
- 실제 DB 테이블명, 컬럼명에 대한 관례는 회사마다 다르다
- 보통 '대문자 + _(언더스코어)'나 '소문자 + _(언더스코어)' 방식을 사용한다


### 참고2
- 외래키가 있는 곳을 연관 관계의 주인으로 정해라

---------------------------------------------------------------------------------------------------------------------------------------

> ## 엔티티 클래스 개발 1

### 연관 관계의 주인
- @JoinColumn을 사용하는 엔티티의 변수가 연관 관계의 주인이다
- mappedBy를 사용하는 엔티티의 변수가 연관 관계의 주인이 아니다


### 하이버네이트 설정
- Project Structure -> Modules -> JPA -> 하이버네이트 선택


### EnumType
    EnumType.STRING
- EnumType.ORDINAL
  - 기본값
  - enum 순서가 들어간다
- EnumType.STRING
  - 무조건 이거 사용
  - enum의 값 이름이 들어간다

---------------------------------------------------------------------------------------------------------------------------------------

> ## 엔티티 클래스 개발 2

### @JoinTable
    @JoinTable(name = "테이블이름",
        joincolumns = @JoinColumn(name = "category_id"),
        inversJoincolumns = @JoinColumn(name = "item_id") 
    )
- 다대다 관계를 해소하는 테이블을 생성해준다


### @Getter, @Setter
- @Getter, @Setter 모두 제공하지 않고, 꼭 필요한 별도의 메서드를 제공하는 것이 가장 이상적이다
- @Setter를 막 열어두는 것은 좋지 않다


### 값 타입
- 불변으로 설계해야 한다
- 생성자를 만들고, Setter 메서드를 없애자

---------------------------------------------------------------------------------------------------------------------------------------

> ## 엔티티 설계시 주의점

### 용어
- fetch : 가져오다
- Eager : 갈망하는


### 엔티티에는 가급적 Setter를 사용하지 말자
- 변경 포인트가 너무 많아서, 유지보수가 어렵다


### 모든 연관 관계는 지연로딩으로 설정
- 즉시로딩은 예측이 어렵고, 어떤 SQL이 실행될지 추적하기 어렵다
- 특히 JPQL을 실행할 때 N+1 문제가 자주 발생한다
- @XToOne(OneToOne, ManyToOne) 관계는 Lazy 설정을 해줘야 한다


### 컬렉션은 필드에서 초기화하자
- 컬렉션은 필드에서 바로 초기화하는 것이 안전하다
- null 문제에서 안전하다
- 하이버네이트는 엔티티를 영속화 할 때, 컬렉션을 감싸서 하이버네이트가 제공하는 내장 컬렉션으로 변경한다 (persist() 등을 수행하면 변경)
  - java.util.arrayList -> org.hibernate.collection.internal.PersistentBag


### 테이블, 컬럼명 생성 전략
- 하이버네이트 기존 구현 : 엔티티의 이름을 그대로 구현
- 논리명 : 테이블이나, 컬럼명을 적시하지 않을 대 논리명 적용
- 물리명 : 모든 논리명에 적용, 실제 테이블에 적용
- CamelCaseToUnderscoresNamingStrategy (스프링 부트 사용시 자동 등록)


### CascadeType
    CascadeType.ALL
- 연관 관계 테이블까지 같은 생명주기를 갖는다


### 연관 관계 편의 메서드
- 연관 관계가 있는 경우, 자주 사용 하는 엔티티 부분에서 연관 관계 편의 메서드를 만들어서 사용하는 것이 좋다



















