
# 회원 도메인 개발

-------------------------------------------------------------------------------------------------------------------------------------

> ## 회원 서비스 개발

### 엔티티 PK
- persist()가 호출될 때 생성된다


### @Transactional
- 클래스 레벨 
  - 클래스 내 public 메서드 모두 트랜잭션 설정이 된다
- 메서드 레벨
  - 메서드에서만 트랜잭션 설정이 된다
  - 클래스 레벨보다 우선권을 갖는다
- @Transactional(readOnly = true)
  - 조회에서 사용


### 생성자 DI 주입
- 생성자가 1개인 경우 @Autowired를 작성하지 않아도 알아서 DI해준다
- @AllArgsConstructor
  - 모든 필드를 가진 생성자를 자동 생성해주는 롬복 어노테이션
- @RequiredArgsConstructor
  - final, @NotNull 이 붙은 필드의 생성자를 자동 생성해주는 롬복 어노테이션


### @PersistenceContext
- EntityManger를 DI 해주는 어노테이션
- 부트 + Spring Data JPA를 사용하면 @Autowired를 통해 DI할 수 있다

-------------------------------------------------------------------------------------------------------------------------------------

> ## 회원 기능 테스트

### 테스트
- given : 어떤 조건
- when : 어떤 상황에서
- then : 어떤 결과가 나와야 한다


### 테스트에서 트랜잭션 롤백 하지 않기
    @Test
    @Transactional
    @Rollback(false)
    ...
- 테스트에서 @Transactional 어노테이션이 있으면 테스트가 종료된 후 Rollback한다
- @Rollback(false) 어노테이션을 붙여야지 롤백되지 않는다


### 테스트 DB
- 스프링 부트를 사용하면 인 메모리 DB를 쉽게 사용할 수 있다


### H2 인메모리
1. test -> resources -> application.yml 파일 설정
2. application.yml에 jdbc:h2:mem:test (인메모리 DB를 설정)


### 스프링부트 인 메모리
- 스프링부트를 사용할 때 application.yml에 DB 설정이 없으면 인 메모리 DB로 돌린다
- 스프링부트 인 메모리는 ddl-auto : create-drop으로 테스트가 끝나면 drop DDL 해준다






















